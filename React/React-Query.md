React-Query ê°œë…ì¡ê¸°
===


## React-Query ë€?

> fetching, caching, ì„œë²„ë°ì´í„°ì™€ì˜ ë™ê¸°í™”ë¥¼ ì§€ì›í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
> 
- ê°„ë‹¨íˆ ë§í•´ React í™˜ê²½ì—ì„œì˜ ë¹„ë™ê¸° Query(ì§ˆì˜) ê³¼ì •ì„ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.

### React-Query ì˜ ì´ì 

1. React Query ëŠ” React Application ì—ì„œ ì„œë²„ìƒíƒœë¥¼ ë¶ˆëŸ¬ì˜¤ê³ , ìºì‹±í•˜ë©°, ì§€ì†ì ìœ¼ë¡œ ë™ê¸°í™”í•˜ê³  ì—…ë°ì´íŠ¸ë¥¼í•˜ëŠ” ì‘ì—…ì„ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
2. ë³µì¡í•˜ê³  ì¥í™©í•œ ì½”ë“œê°€ í•„ìš”í•œ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ë°©ì‹ê³¼ ë‹¬ë¦¬ React Component ë‚´ë¶€ì—ì„œ ê°„ë‹¨í•˜ê³  ì§ê´€ì ìœ¼ë¡œ API ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
3. ë” ë‚˜ì•„ê°€ React Query ì—ì„œ ì œê³µí•˜ëŠ” ìºì‹±, Window Focus Refetching ë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ API ìš”ì²­ê³¼ ê´€ë ¨ëœ ë²ˆì¡í•œ ì‘ì—… ì—†ì´ â€œí•µì‹¬ ë¡œì§â€ ì— ì§‘ì¤‘í•  ìˆ˜ ìˆë‹¤.

 ì¦‰, React-Query ëŠ” í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¹„ë™ê¸° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê³¼ì • ì¤‘ ë°œìƒí•˜ëŠ” ë¬¸ì œë“¤ì„ í•´ê²°í•´ì¤€ë‹¤ëŠ” ê±´ë°, ì–´ë–¤ ë¬¸ì œë“¤ì„ ì–´ë–»ê²Œ í•´ê²°í•œë‹¤ëŠ” ê±¸ê¹Œ?

---

## 1. ìºì‹±( Caching)

React-Query ì˜ ì¥ì  ì¤‘ í•˜ë‚˜ëŠ” **ë°ì´í„°ë¥¼ ìºì‹±**í•œë‹¤ëŠ” ì ì´ë‹¤.

> ìºì‹±ì´ë‘ íŠ¹ì • ë°ì´í„°ì˜ ë³µì‚¬ë³¸ì„ ì €ì¥í•˜ì—¬, ì´í›„ ë™ì¼í•œ ë°ì´í„°ì˜ ì¬ì ‘ê·¼ ì†ë„ë¥¼ ë†’ì´ëŠ” ê²ƒì„ ë§í•œë‹¤!
> 

React-Query ëŠ” ìºì‹±ì„ í†µí•´ ë™ì¼í•œ ë°ì´í„°ì— ëŒ€í•œ **ë°˜ë³µì ì¸ ë¹„ë™ê¸° ë°ì´í„° í˜¸ì¶œì„ ë°©ì§€**í•˜ê³ , ì´ëŠ” ë¶ˆí•„ìš”í•œ API ì½œì„ ì¤„ì—¬ **ì„œë²„ì— ëŒ€í•œ ë¶€í•˜ë¥¼ ì¤„ì´ëŠ” ì¢‹ì€ ê²°ê³¼**ë¥¼ ê°€ì ¸ì˜¨ë‹¤.

> ìµœì‹ ì˜ ë°ì´í„°ì¸ì§€ ì–´ë–»ê²Œ íŒë³„í•˜ëŠ”ë°?
> 
- ì—¬ê¸°ì„œ ê¶ê¸ˆí•œ ê²ƒì€ ë°ì´í„°ê°€ ìµœì‹ ì˜ ê²ƒì¸ì§€ ì•„ë‹Œì§€ì— ëŒ€í•œ ê²ƒì´ë‹¤.
    
    ë§Œì¼ ì„œë²„ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ìºì‹±í•œ í›„, ì‹¤ì œ ë°ì´í„°ë¥¼ í™•ì¸í–ˆì„ ë•Œ ì„œë²„ ìƒì—ì„œ ë°ì´í„°ì˜ ìƒíƒœê°€ ë³€ê²½ë˜ì–´ìˆë‹¤ë©´, ì‚¬ìš©ìëŠ” ì‹¤ì œ ë°ì´í„°ê°€ ì•„ë‹Œ ë³€ê²½ ì „ì˜ ë°ì´í„°ë¥¼ ë°”ë¼ë³¼ ìˆ˜ ë°–ì— ì—†ê²Œ ëœë‹¤. ì´ëŠ” ì‚¬ìš©ìì—ê²Œ ì˜ëª»ëœ ì •ë³´ë¥¼ ë³´ì—¬ì£¼ëŠ” ì—ëŸ¬ë¥¼ ë‚³ëŠ”ë‹¤. 
    

> ì°¸ê³ ë¡œ, React-Query ì—ì„œëŠ” **ìµœì‹ ì˜ ë°ì´í„°ë¥¼ fresh í•œ ë°ì´í„°**, **ê¸°ì¡´ì˜ ë°ì´í„°ë¥¼ stale í•œ ë°ì´í„°**ë¼ê³  í•œë‹¤.
> 

### ì–¸ì œ ë°ì´í„°ë¥¼ ê°±ì‹ í•´ì•¼í•˜ì§€?

ìœ„ì™€ ê°™ì€ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•ŠëŠ” ì¢‹ì€ ìºì‹± ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤ëŠ” ê²ƒì€ ê²°êµ­ **í•„ìš”í•œ ìƒí™©ì— ì ì ˆí•˜ê²Œ ë°ì´í„°ë¥¼ ê°±ì‹ **í•´ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ë§ê³¼ ê°™ë‹¤. ê·¸ëŸ¼ ê·¸ëŸ° ìƒí™©ì€ ì–¸ì œì¼ê¹Œ?

```
1. í™”ë©´ì„ ë³´ê³  ìˆì„ ë•Œ
2. í˜ì´ì§€ì˜ ì „í™˜ì´ ì¼ì–´ë‚¬ì„ ë•Œ
3. í˜ì´ì§€ ì „í™˜ ì—†ì´ ì´ë²¤íŠ¸ê°€ ë°œìƒí•´ ë°ì´í„°ë¥¼ ìš”ì²­í•  ë•Œ
```

í¬ê²Œ ë³´ë©´ ìœ„ì˜ 3ê°€ì§€ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤. ì´ë¥¼ ìœ„í•´ React-Query  ì—ì„œëŠ” ê¸°ë³¸ì ì¸ ì•„ë˜ì˜ ì˜µì…˜ë“¤ì„ ì œê³µí•œë‹¤.

```
refetchOnWindowFocus, // default : true
refetchOnMount, // default: true
refetchOnReconnect, // defulat: true
staleTime, // default: 0
cacheTime, // defualt: 5ë¶„ (60 * 5 * 1000)
```

ìœ„ì˜ ì˜µì…˜ë“¤ì„ í†µí•´ ìš°ë¦¬ëŠ” React-Query ê°€ ì–´ë–¤ ì‹œì ì— ë°ì´í„°ë¥¼ Refetching í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤.

```
1. ë¸Œë¼ìš°ì €ì— í¬ì»¤ìŠ¤ê°€ ë“¤ì–´ì˜¨ ê²½ìš°(refetchOnWindowFocus)
2. ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ê°€ ë°œìƒí•œ ê²½ìš°(refetchOnMount)
3. ë„¤íŠ¸ì›Œí¬ ì¬ì—°ê²°ì´ ë°œìƒí•œ ê²½ìš°(refetchOnFeconnect)
```

### staleTime ? cacheTime ?

### staleTime

- staleTime ì€ **ë°ì´í„°ê°€ fresh â†’ stale ìƒíƒœë¡œ ë³€ê²½**ë˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì‹œê°„
- fresh ìƒíƒœì¼ ë•ŒëŠ” Refetch íŠ¸ë¦¬ê±°(ìœ„ì˜ 3ê°€ì§€ ê²½ìš°) ê°€ ë°œìƒí•´ë„ Refetch ê°€ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤.
- ê¸°ë³¸ê°’ì´ 0 ì´ë¯€ë¡œ ë”°ë¡œ ì„¤ì •í•´ì£¼ì§€ ì•ŠëŠ”ë‹¤ë©´, Refetch íŠ¸ë¦¬ê±°ê°€ ë°œìƒí–ˆì„ ë•Œ ë¬´ì¡°ê±´ Refetch ê°€ ë°œìƒí•œë‹¤.

### cacheTime

- cacheTime ì€ ë°ì´í„°ê°€ inactive í•œ ìƒíƒœ(ë°ì´í„°ê°€ í˜„ì¬ ì‚¬ìš©ë˜ì§€ ì•Šê±°ë‚˜, ì ‘ê·¼ë˜ì§€ ì•ŠëŠ” ìƒíƒœ)ì¼ ë•Œ ìºì‹±ëœ ìƒíƒœë¡œ ë‚¨ì•„ìˆëŠ” ì‹œê°„ì´ë‹¤.
- íŠ¹ì • ì»´í¬ë„ŒíŠ¸ê°€ unmount(í˜ì´ì§€ ì „í™˜ ë“±ìœ¼ë¡œ í™”ë©´ì—ì„œ ì‚¬ë¼ì§ˆ ë•Œ) ë˜ë©´ ì‚¬ìš©ëœ ë°ì´í„°ëŠ” inactive ìƒíƒœë¡œ ë°”ë€Œê³ , ì´ë•Œ ë°ì´í„°ëŠ” cacheTime ë§Œí¼ ìœ ì§€ëœë‹¤.
- cacheTime ì´í›„ ë°ì´í„°ë¥¼ ê°€ë¹„ì§€ ì½œë ‰í† ë¡œ ìˆ˜ì§‘ë˜ì–´ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œëœë‹¤.
- ë§Œì¼ cacheTime ì´ ì§€ë‚˜ì§€ ì•Šì•˜ëŠ”ë° í•´ë‹¹ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ì‹œ mount ë˜ë©´, ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ fetch í•´ì˜¤ëŠ” ë™ì•ˆ ìºì‹±ëœ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤€ë‹¤.
- ì¦‰, ìºì‹œëœ ë°ì´í„°ë¥¼ ê³„ì† ë³´ì—¬ì£¼ëŠ”ê²Œ ì•„ë‹ˆë¼ fetch í•˜ëŠ” ë™ì•ˆ ì„ì‹œë¡œ ë³´ì—¬ì¤€ë‹¤ëŠ” ê²ƒì´ë‹¤.

## 2. Client ë°ì´í„°ì™€ Server ë°ì´í„° ê°„ì˜ ë¶„ë¦¬

í”„ë¡œì íŠ¸ì˜ ê·œëª¨ê°€ ì»¤ì§€ê³  ê´€ë¦¬í•´ì•¼í•  ë°ì´í„°ê°€ ë„˜ì¹˜ë‹¤ ë³´ë©´, Client ì—ì„œ ê´€ë¦¬í•˜ëŠ” ë°ì´í„°ì™€ Server ì—ì„œ ê´€ë¦¬í•˜ëŠ” ë°ì´í„°ê°€ ë¶„ë¦¬ë  í•„ìš”ì„±ì„ ëŠë‚€ë‹¤. 

> **Client Data:** ëª¨ë‹¬ ê´€ë ¨ ë°ì´í„°, í˜ì´ì§€ ê´€ë ¨ ë°ì´í„° ë“±ë“±..
**Server Data:** ì‚¬ìš©ì ì •ë³´, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê´€ë ¨ ì •ë³´ ë“±ë“±..

ê°„ë‹¨í•˜ê²Œ ìƒê°í•´ì„œ **ë¹„ë™ê¸° API í˜¸ì¶œì„ í†µí•´ ë¶ˆëŸ¬ì˜¤ëŠ” ë°ì´í„°**ë“¤ì„ Server ë°ì´í„°ë¼ê³  í•  ìˆ˜ ìˆë‹¤.
> 

ì‹¤ì œ Client ë°ì´í„° ê²½ìš°, Redux, Recoil, mobX ì™€ ê°™ì€ **ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬**ë“¤ì„ í†µí•´ ì˜ ê´€ë¦¬ë˜ì–´ì˜¤ê³  ìˆìœ¼ë‚˜, ë¬¸ì œëŠ” ì´ëŸ¬í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì´ Server ë°ì´í„°ê¹Œì§€ë„ ê´€ë¦¬ë¥¼ í•´ì•¼í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•œë‹¤ëŠ” ê²ƒì´ë‹¤. 

ìœ„ì˜ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œë„ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¡œì§ì´ ì¡´ì¬í•˜ê±°ë‚˜, ì„œë“œ íŒŒí‹°ë¥¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì§€ì›í•˜ëŠ” ê²ƒì´ ë§ë‹¤. ê·¸ëŸ¬ë‚˜ ì´ë“¤ì´ Client ë°ì´í„°ì™€ Server ë°ì´í„°ë¥¼ ì™„ë²½íˆ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬ì— ìš©ì´í•˜ë„ë¡ ì¶©ë¶„íˆ ê¸°ëŠ¥ì´ ì§€ì›ëœë‹¤ê³  ë³´ê¸° ì–´ë µë‹¤.  ì¦‰, ìœ„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì€ Client ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ë° ë¡œì§ì´ ì§‘ì¤‘ë˜ì–´ìˆê¸° ë•Œë¬¸ì—, Server ë°ì´í„°ê¹Œì§€ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ë°ëŠ” í•œê³„ê°€ ë¶„ëª…í•˜ë‹¤.

React-Query ëŠ” ì´ëŸ¬í•œ ë¬¸ì œì— ëŒ€í•œ í•´ê²°ì±… ë˜í•œ ì œì‹œí•´ ì¤Œ 

```jsx
// í•´ë‹¹ ë‚´ìš©ì€ v4ì˜ ë¬¸ë²•ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ë‚´ìš©ì…ë‹ˆë‹¤. 
// ë‹¨ìˆœíˆ ê°œë…ì ì¸ ì˜ˆì‹œë¥¼ ì„¤ëª…í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. 
// v5 ì˜ˆì‹œëŠ” ì•„ë˜ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
const { data, isLoading } = useQueries({
	['unique-key'],
	() => {
		return api({
			url: URL,
			method: 'GET',
		});
	},
	{
		onSuccess: (data) => {
			// dataë¡œ ì´ê²ƒì €ê²ƒ í•˜ëŠ” ë¡œì§
		}
	},
	{
		onError: (error) => {
			// errorë¡œ ì´ê²ƒì €ê²ƒ í•˜ëŠ” ë¡œì§
		}
	}
})
```

ì˜ˆì‹œì—ì„œëŠ” ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ìœ„ì™€ ê°™ì€  ë¡œì§ì„ í†µí•´ Server ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆëŠ”ë°, ì´ë•Œ onSuccess ì™€ onError í•¨ìˆ˜ë¥¼ í†µí•´ fetch ì„±ê³µê³¼ ì‹¤íŒ¨ì— ëŒ€í•œ ë¶„ê¸°ë¥¼ ì•„ì£¼ ê°„ë‹¨íˆ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” Server ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê³¼ì •ì—ì„œ êµ¬í˜„í•´ì•¼í•  ì¶”ê°€ì ì¸ ì„¤ì •ë“¤ì„ ì§„í–‰í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ì´ì•¼ê¸°ì´ë‹¤. 

**ì¦‰, Client ë°ì´í„°ëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ê´€ë¦¬í•˜ê³ , Server ë°ì´í„°ëŠ” React-Query ê°€ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡°ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤!! ì´ë¥¼ í†µí•´ ìš°ë¦¬ëŠ” Client ë°ì´í„°ì™€ Server ë°ì´í„°ë¥¼ ì˜¨ì „í•˜ê²Œ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.**

> ë¬¼ë¡  ì—¬ê¸°ì„œ React-Query ê°€ ê°€ì ¸ì˜¨ Server ë°ì´í„°ë¥¼ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ì „ì—­ ìƒíƒœë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ì‡ëŠ” ê±´ ì‚¬ì‹¤ì´ë‹¤. ê·¸ëŸ¬ë‚˜ refetch ê°€ ì—¬ëŸ¬ ë²ˆ ì¼ì–´ë‚˜ëŠ” ìƒí™©ì— ë§¤ë²ˆ Server ë°ì´í„°ë¥¼ ì „ì—­ ìƒíƒœë¡œ ê°€ì ¸ì˜¤ëŠ”ê²ƒì´ ì˜³ì€ì§€ íŒë‹¨í•˜ëŠ” ê²ƒì€ ìš°ë¦¬ì˜ ëª«ì´ë‹¤. ê°œë°œí•˜ëŠ” ì„œë¹„ìŠ¤ì˜ ìƒí™©ì— ë§ê²Œ ì˜ ì„ íƒí•´ë³´ë„ë¡ í•˜ì!!
> 

## 3. React-Query ê°€ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ë°©ë²•

React-Query ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ì—ëŸ¬ë¥¼ ê²ªì€ ë¶„ë“¤ì´ë‚˜, í”„ë¡ íŠ¸ì—”ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œë¥¼ ì¡°ê¸ˆì´ë¼ë„ ëœ¯ì–´ë³´ì‹  ë¶„ë“¤ì€ ì‰½ê²Œ ì•Œ ìˆ˜ ìˆì„í…ë°, React-Query ë˜í•œ React ì˜ ContextAPI ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤. 

ì „ì²´ Scope ê°€ ë˜ë©° í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë“¤ì˜ server data ë¥¼ ê´€ë¦¬í•˜ëŠ” QueryClient ê°€ ì¡´ì¬í•˜ëŠ” ë°, í•´ë‹¹ QueryClient ëŠ” ìš°ë¦¬ê°€ Query ë¥¼ ì‚¬ìš©í•  ë•Œ ëª…ì‹œí•˜ëŠ” Key ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤. 

ì¦‰, ë‹¤ì‹œ ë§í•´ QueryClient ëŠ” ë‹¨ìˆœíˆ ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê³³ì´ë¼ê¸°ë³´ë‹¤ëŠ”, ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©ë˜ëŠ” Context Store ì™€ ë™ì¼í•œ ì—­í• ì„ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ ìš©ë„ê°€ ì„œë²„ ë°ì´í„° ê´€ë¦¬ì— ì´ˆì ì„ ë‘ëŠ” ê²ƒì¼ ë¿ì´ê¸°ì—, ìš°ë¦¬ëŠ” í•„ìš”ì— ë”°ë¼ QueryClient ë˜í•œ ë‹¨ìˆœ ë°ì´í„° ì €ì¥ì†Œì²˜ëŸ¼ ê°„ì£¼í•˜ê³  ììœ ìì¬ë¡œ í™œìš©í•  ìˆ˜ ìˆì–´ì•¼í•œë‹¤. 

> ì‹¤ì œ tanstack/@react-queryê³µì‹ë¬¸ì„œë¥¼ ì‚´í´ë³´ë©´Â `getQueryData`,Â `setQueryData`,Â `fetchQuery`Â ë“±ë“± QueryClient ë¼ëŠ” ì €ì¥ì†Œë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì •ë§ ë‹¤ì–‘í•œ ë©”ì„œë“œê°€ ì¡´ì¬í•œë‹¤. í•´ë‹¹ ë©”ì„œë“œë“¤ì€ ë°ì´í„°ë¥¼ ì–´ë– í•œ ë°©ì‹(ë¹„ë™ê¸°/ë™ê¸°, ìºì‹± ë“±)ìœ¼ë¡œ ê´€ë¦¬í• ì§€ì— ë”°ë¼ ë‚˜ë‰˜ë©°, ê° ë©”ì„œë“œì˜ íŠ¹ì§•ê³¼ í™œìš© ìš©ë„ë¥¼ ì •í™•í•˜ê²Œ íŒŒì•…í•˜ê³  ìˆì–´ì•¼ ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì œëŒ€ë¡œ í™œìš©í•˜ê³  ìˆë‹¤ê³  ë§í•  ìˆ˜ ìˆë‹¤.

React-queryëŠ” íƒ€ íˆ´ë“¤ì— ë¹„êµí•˜ë©´ ë©ì¹˜ê°€ ë‚˜ë¦„ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ê¸° ë•Œë¬¸ì— ì¶”í›„ ë²ˆë“¤ ì‚¬ì´ì¦ˆì—ì„œ ë‹¨ì ì´ ë“œëŸ¬ë‚  ìˆ˜ ìˆëŠ” ì—¬ì§€ê°€ ìˆë‹¤. ë”°ë¼ì„œ ì‚¬ìš©í•˜ê³ ì í•œë‹¤ë©´ ìœ„ì™€ ê°™ì€ ë‹¤ì–‘í•œ ë„êµ¬ë“¤ì„ ì œëŒ€ë¡œ í™œìš©í•˜ì—¬ ë²ˆë“¤ì˜ ë©”ëª¨ë¦¬ë¥¼ í—›ë˜ì´í•˜ì§€ ì•ŠëŠ” í˜„ëª…í•œ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìê°€ ë˜ì.
> 

## 4. ëŒ€í‘œì ì¸ ê¸°ëŠ¥ë“¤

React-Query ì—ì„œ data fetching ì„ ìœ„í•´ ì œê³µí•˜ëŠ” ëŒ€í‘œì ì¸ ê¸°ëŠ¥ë“¤ì„ ì‚´í´ë³´ì

ê¸°ë³¸ì ìœ¼ë¡œ Get ì—ëŠ” useQuery ê°€,  PUT, UPDATE, DELETE ì—ëŠ” useMutation ì´ ì‚¬ìš©ëœë‹¤. 

### useQuery

- ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ unique key ë¥¼ í¬í•¨í•œ ë°°ì—´ì´ ë“¤ì–´ê°„ë‹¤. ì´í›„ ë™ì¼í•œ ì¿¼ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœë‹¤.
- ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ë“¤ì–´ê°€ëŠ” ë°°ì—´ì˜ ì²« ìš”ì†ŒëŠ” unique key ë¡œ ì‚¬ìš©ë˜ê³ , ë‘ ë²ˆì§¸ ìš”ì†Œë¶€í„°ëŠ” query í•¨ìˆ˜ ë‚´ë¶€ì˜ íŒŒë¼ë¯¸í„°ë¡œ ê°’ë“¤ì´ ì „ë‹¬ëœë‹¤.
- ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ ì‹¤ì œ í˜¸ì¶œí•˜ê³ ì í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ë“¤ì–´ê°„ë‹¤. ì´ë•Œ í•¨ìˆ˜ëŠ” Primise ë¥¼ ë°˜í™˜í•˜ëŠ” í˜•íƒœì—¬ì•¼í•œë‹¤.
- ìµœì¢… ë°˜í™˜ ê°’ì€ API ì˜ ì„±ê³µ, ì‹¤íŒ¨ ì—¬ë¶€, ë°˜í™˜ê°’ì„ í¬í•¨í•œ ê°ì²´ì´ë‹¤.

Ex)

```jsx
import {
  QueryClient,
  QueryClientProvider,
  useQuery,
} from '@tanstack/react-query'

const queryClient = new QueryClient()

export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Example />
    </QueryClientProvider>
  )
}

function Example() {
  const { isPending, error, data } = useQuery({
    queryKey: ['repoData'],
    queryFn: () =>
      fetch('https://api.github.com/repos/tannerlinsley/react-query').then(
        (res) => res.json(),
      ),
  })

  if (isPending) return 'Loading...'

  if (error) return 'An error has occurred: ' + error.message

  return (
    <div>
      <h1>{data.name}</h1>
      <p>{data.description}</p>
      <strong>ğŸ‘€ {data.subscribers_count}</strong>{' '}
      <strong>âœ¨ {data.stargazers_count}</strong>{' '}
      <strong>ğŸ´ {data.forks_count}</strong>
    </div>
  )
}
```

- useQuery í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” ê°ì²´ë¥¼ ë³´ë©´ isPending ì„ í†µí•´ ë¡œë”© ì—¬ë¶€ë¥¼, error ë¥¼ í†µí•´ ì—ëŸ¬ ë°œìƒ ì—¬ë¶€ë¥¼, data ë¥¼ í†µí•´ ì„±ê³µ ì‹œ ë°ì´í„°ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤.
- isPending ê³¼ error ë¥¼ ì´ìš©í•˜ì—¬ ê° ìƒí™© ë³„ ë¶„ê¸°ë¥¼ ì‰½ê²Œ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.

### useQuery ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰

- useQuery ì—ì„œ enabled ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë¹„ë™ê¸° í•¨ìˆ˜ì¸ useQuery ë¥¼ ë™ê¸°ì ìœ¼ë¡œ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.
- useQuery ì˜ ì„¸ ë²ˆì§¸ ì¸ìë¡œ ë‹¤ì–‘í•œ ì˜µì…˜ ê°’ë“¤ì´ ë“¤ì–´ê°€ëŠ”ë°, ì—¬ê¸°ì„œ enabled ì— ê°’ì„ ëŒ€ì…í•˜ë©´ í•´ë‹¹ ê°’ì´ true ì¼ë•Œ useQuery ë¥¼ ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•œë‹¤.

```jsx
const { data: todoList, error, isFetching } = useQuery({
	queryKey: ["todos"], 
  	queryFn: fetchTodoList,
});
const { data: nextTodo, error, isFetching } = useQuery({
  queryKey: ["nextTodos"],
  queryFn: fetchNextTodoList,
  enabled: !!todoList // trueê°€ ë˜ë©´ fetchNextTodoListë¥¼ ì‹¤í–‰í•œë‹¤
});
```

### useQueries

ì—¬ëŸ¬ ê°œì˜ useQuery ë¥¼ í•œ ë²ˆì— ì‹¤í–‰í•˜ê³ ì í•˜ëŠ” ê²½ìš°, ê¸°ì¡´ì˜ Promise.all() ì²˜ëŸ¼ ë¬¶ì–´ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.

```jsx
const ids = [1, 2, 3]
const results = useQueries({
  queries: ids.map((id) => ({
    queryKey: ['post', id],
    queryFn: () => fetchPost(id),
    staleTime: Infinity,
  })),
})

// ë‘ queryì— ëŒ€í•œ ë°˜í™˜ê°’ì´ ë°°ì—´ë¡œ ë¬¶ì—¬ ë°˜í™˜ëœë‹¤!!

// ë§Œì¼ ë°˜í™˜ëœ ë°°ì—´ì— ëŒ€í•´ í†µí•©ëœ ê°’ì„ ë¶ˆëŸ¬ì˜¤ê³  ì‹¶ë‹¤ë©´, ì•„ë˜ì™€ ê°™ì´ combine ì„¤ì •ì„ í†µí•´ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ë°˜í™˜í•  ìˆ˜ ìˆë‹¤. ì´ì™¸ì—ë„ ë°°ì—´ì„ ë‹¤ë£¨ëŠ” ë©”ì„œë“œë“¤ì„ ì´ìš©í•´ ë°˜í™˜ê°’ì— ëŒ€í•œ ì „ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤!

const ids = [1, 2, 3]
const combinedQueries = useQueries({
  queries: ids.map((id) => ({
    queryKey: ['post', id],
    queryFn: () => fetchPost(id),
  })),
  combine: (results) => {
    return {
      data: results.map((result) => result.data),
      pending: results.some((result) => result.isPending),
    }
  },
})
```

### useMutation

- ìœ„ì—ì„œ ì–¸ê¸‰í•œ ê²ƒì²˜ëŸ¼ PUT, UPDATE, DELETE ì™€ ê°™ì´ ê°’ì„ ë³€ê²½í•  ë•Œ ì‚¬ìš©í•˜ëŠ” API ì´ë‹¤. ë°˜í™˜ê°’ì€ useQuery ì™€ ë™ì¼í•˜ë‹¤.

Ex)

```jsx
function App() {
  const mutation = useMutation({
    mutationFn: (newTodo) => {
      return axios.post('/todos', newTodo)
    },
  })

  return (
    <div>
      {mutation.isLoading ? (
        'Adding todo...'
      ) : (
        <>
          {mutation.isError ? (
            <div>An error occurred: {mutation.error.message}</div>
          ) : null}

          {mutation.isSuccess ? <div>Todo added!</div> : null}

          <button
            onClick={() => {
              mutation.mutate({ id: new Date(), title: 'Do Laundry' })
            }}
          >
            Create Todo
          </button>
        </>
      )}
    </div>
  )
}
```

- ìœ„ì˜ ì½”ë“œì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ ë°˜í™˜ê°’ì€ useQuery ì™€ ë™ì¼í•˜ì§€ë§Œ, ì²˜ìŒ ì‚¬ìš© ì‹œì— post ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ë„£ì–´ì£¼ì—ˆë‹¤. ì´ë•Œ useMutation ì˜ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ë“¤ì–´ê°€ê³ , ë‘ ë²ˆì§¸ ì¸ìë¡œ ìƒí™© ë³„ ë¶„ê¸° ì„¤ì •ì´ ë“¤ì–´ê°„ë‹¤ëŠ” ì ì´ ì°¨ì´ì´ë‹¤.
- ì‹¤ì œ ì‚¬ìš© ì‹œì—ëŠ” mutation.mutate ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ê³ , ì²« ë²ˆì§¸ ì¸ìë¡œ API í˜¸ì¶œ ì‹œì— ì „ë‹¬í•´ì£¼ì–´ì•¼í•˜ëŠ” ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ë©´ ëœë‹¤.